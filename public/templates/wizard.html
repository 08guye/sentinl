<div class="app-container sentinl" ng-controller="WizardController" id="main">
  <kbn-top-nav name="sentinl" config="topNavMenu">
    <!-- Transcluded elements. -->
    <div data-transclude-slots>

      <!-- Tabs. -->
      <div data-transclude-slot="bottomRow" class="kuiLocalTabs">
        <a
          ng-repeat="item in tabsMenu.list"
          class="kuiLocalTab"
          ng-class="{'kuiLocalTab-isSelected': tabsMenu.currentPath === item.url}"
          kbn-href="{{::item.url}}"
        >
          {{::item.display}}
        </a>
      </div>
    </div>
  </kbn-top-nav>

  <div class="row container">
    <div class="col-12">
      <form name="watcherForm" class="form-horizontal" id="watcher-wizard" novalidate>

        <uib-tabset>

          <uib-tab active index="0" heading="General">
            <div class="tab-content">
              <div class="form-group" ng-class="{'has-error': watcherForm.title.$invalid && !watcherForm.title.$pristine}">
                <label class="control-label col-md-2" for="title">Title</label>
                <div class="col-md-6">
                  <input
                    type="text"
                    id="title"
                    name="title"
                    value="{{watcher._source.title}}"
                    class="form-control"
                    ng-model="watcher._source.title"
                    required>
                </div>
                <p ng-if="watcherForm.title.$invalid && !watcherForm.title.$pristine" class="help-block">
                  Watcher title is required.
                </p>
              </div> <!-- end form-group -->
              <div class="form-group">
                <div class="col-md-2 period-tag-label">
                  <label>Run every</label>
                </div>
                <div class="col-md-10">
                  <period-tag timesrc="watcher._source.$$schedule"></period-tag>
                </div>
              </div> <!-- end form-group -->
            </div> <!-- end tab-content -->
          </uib-tab> <!-- end general -->

          <uib-tab index="1" heading="Input" disable="form.tabs.input.disable">
            <div class="tab-content">
              <div class="form-group">
                <div class="col-md-2"></div>
                <div class="col-md-6">
                  <div class="btn-group" uib-dropdown is-open="status.isopenInput">
                    <button type="button" class="btn btn-default" uib-dropdown-toggle ng-disabled="disabled">
                      Load input <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" uib-dropdown-menu role="menu">
                      <li ng-repeat="(id, script) in form.scripts.input">
                        <a href="javascript:void(0)" ng-click="selectScript('input', id)">{{ script.title }}</a>
                      </li>
                      <li ng-show="isEmpty(form.scripts.input)">
                        <a href="javascript:void(0)">No scripts stored</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group">
                <label class="col-md-2 control-label" for="inputTitle">Title</label>
                <div class="col-md-6">
                  <input
                    type="text"
                    id="inputTitle"
                    name="inputTitle"
                    value="{{watcher.$$scripts.input.title}}"
                    class="form-control"
                    placeholder="title"
                    ng-model="watcher.$$scripts.input.title">
                </div>
                <p ng-show="watcherForm.inputTitle.$invalid" class="text-danger">Title is required.</p>
              </div> <!-- end form-group -->
              <div class="form-group">
                <label class="col-md-2 control-label" for="inputTitle">Body</label>
                <div class="col-md-6">
                  <div id="inputEdit"
                    ng-model="watcher.$$scripts.input.body"
                    ui-ace="aceOptions('json', 30)">{{ watcher.$$scripts.input.body }}</div>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group">
                <div class="col-md-2">
                </div>
                <div class="col-md-6">
                  <button type="button" class="btn btn-default btn-sm" ng-click="saveScript('input')">Save</button>
                  <button type="button" class="btn btn-default btn-sm" ng-click="removeScript('input')">Remove</button>
                </div>
              </div> <!-- end form-group -->
            </div> <!-- end tab-content -->
          </uib-tab> <!-- end input -->

          <uib-tab index="2" heading="Condition" disable="form.tabs.condition.disable">
            <div class="tab-content">
              <div class="form-group">
                <div class="col-md-2"></div>
                <div class="col-md-6">
                  <div class="btn-group" uib-dropdown is-open="status.isopenCondition">
                    <button type="button" class="btn btn-default dropdown-toggle" uib-dropdown-toggle ng-disabled="disabled">
                      Load condition <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" uib-dropdown-menu role="menu">
                      <li ng-repeat="(id, script) in form.scripts.condition">
                        <a href="javascript:void(0)" ng-click="selectScript('condition', id)">{{ script.title }}</a>
                      </li>
                      <li ng-show="isEmpty(form.scripts.condition)">
                        <a href="javascript:void(0)">No scripts stored</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group">
                <label class="col-md-2 control-label" for="conditionTitle">Title</label>
                <div class="col-md-6">
                  <input
                    type="text"
                    id="conditionTitle"
                    name="conditionTitle"
                    value="{{watcher.$$scripts.condition.title}}"
                    class="form-control"
                    placeholder="title"
                    ng-model="watcher.$$scripts.condition.title">
                </div>
                <p ng-show="watcherForm.conditionTitle.$invalid" class="text-danger">Title is required.</p>
              </div> <!-- end form-group -->
              <div class="form-group">
                <label class="col-md-2 control-label" for="conditionTitle">Body</label>
                <div class="col-md-6">
                  <div id="conditionEdit"
                    ng-model="watcher.$$scripts.condition.body"
                    ui-ace="aceOptions('javascript', 30)">{{ watcher.$$scripts.condition.body }}</div>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group">
                <div class="col-md-2">
                </div>
                <div class="col-md-6">
                  <button type="button" class="btn btn-default btn-sm" ng-click="saveScript('condition')">Save</button>
                  <button type="button" class="btn btn-default btn-sm" ng-click="removeScript('condition')">Remove</button>
                </div>
              </div> <!-- end form-group -->
            </div> <!-- end tab-content -->
          </uib-tab> <!-- end condition -->

          <uib-tab index="3" heading="Transform" disable="form.tabs.transform.disable">
            <div class="tab-content">
              <div class="form-group">
                <div class="col-md-2"></div>
                <div class="col-md-4">
                  <div class="btn-group" uib-dropdown is-open="status.isopenTransform">
                    <button type="button" class="btn btn-default dropdown-toggle" uib-dropdown-toggle ng-disabled="disabled">
                      Load transform <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" uib-dropdown-menu role="menu">
                      <li ng-repeat="(id, script) in form.scripts.transform">
                        <a href="javascript:void(0)" ng-click="selectScript('transform', id)">{{ script.title }}</a>
                      </li>
                      <li ng-show="isEmpty(form.scripts.transform)">
                        <a href="javascript:void(0)">No scripts stored</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group">
                <label class="col-md-2 control-label" for="transformTitle">Title</label>
                <div class="col-md-6">
                  <input
                    type="text"
                    id="transformTitle"
                    name="transformTitle"
                    value="{{watcher.$$scripts.transform.title}}"
                    class="form-control"
                    placeholder="title"
                    ng-model="watcher.$$scripts.transform.title">
                </div>
                <p ng-show="watcherForm.transformTitle.$invalid" class="text-danger">Title is required.</p>
              </div> <!-- end form-group -->
              <div class="form-group">
                <label class="col-md-2 control-label" for="transformTitle">Body</label>
                <div class="col-md-6">
                  <div id="transformEdit"
                    ng-model="watcher.$$scripts.transform.body"
                    ui-ace="aceOptions('javascript', 30)">{{ watcher.$$scripts.transform.body }}</div>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group">
                <div class="col-md-2">
                </div>
                <div class="col-md-6">
                  <button type="button" class="btn btn-default btn-sm" ng-click="saveScript('transform')">Save</button>
                  <button type="button" class="btn btn-default btn-sm" ng-click="removeScript('transform')">Remove</button>
                </div>
              </div> <!-- end form-group -->
            </div> <!-- end tab-content -->
          </uib-tab> <!-- end transform -->

          <uib-tab index="4" heading="Actions">
            <div class="tab-content">
              <div class="form-group">
                <div class="col-md-6">
                  <new-action></new-action>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group" ng-if="actionsExist(watcher._source.actions)">
                <div class="col-md-8">
                  <uib-accordion close-others="true" ng-repeat="(actionName, actionSettings) in watcher._source.actions">
                    <webhook-action ng-if="actionOfType(actionSettings, 'webhook')" name="{{actionName}}"></webhook-action>
                    <email-action ng-if="actionOfType(actionSettings, 'email')" name="{{actionName}}"></email-action>
                    <report-action ng-if="actionOfType(actionSettings, 'report')" name="{{actionName}}"></report-action>
                    <email-html-action ng-if="actionOfType(actionSettings, 'email_html')" name="{{actionName}}"></email-html-action>
                    <slack-action ng-if="actionOfType(actionSettings, 'slack')" name="{{actionName}}"></slack-action>
                    <console-action ng-if="actionOfType(actionSettings, 'console')" name="{{actionName}}"></console-action>
                  </uib-accordion>
                </div>
              </div> <!-- end form-group -->
            </div> <!-- end tab-content -->
          </uib-tab> <!-- end actions -->

          <uib-tab index="5" heading="Raw">
            <div class="tab-content">
              <div class="form-group">
                <div class="col-md-2">
                  <input type="checkbox" ng-model="form.rawEnabled" ng-checked="form.rawEnabled"> enable
                  <i class="fa fa-question-circle"
                    aria-hidden="true"
                    uib-popover="The settings below will be applied if enable is checked and the wizard is saved"
                    popover-trigger="'mouseenter'"></i>
                </div>
              </div> <!-- end form-group -->
              <div class="form-group">
                <div class="col-md-8">
                  <div ui-ace="aceOptions('json', 30)" ng-model="watcher.$$raw"></div>
                </div>
              </div> <!-- end form-group -->
            </div> <!-- end tab-content -->
          </uib-tab> <!-- end raw -->

        </uib-tabset>

      </form> <!-- end watcher-wizard -->
    </div> <!-- end col-12 -->
  </div> <!-- end row -->
</div> <!-- end main -->
